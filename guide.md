# üì¶ Ro-Link Installation Guide

This guide will walk you through setting up Ro-Link, from creating the Discord Bot to deploying the Next.js application and integrating it with your Roblox game.

## ‚úÖ Prerequisites

1.  **Node.js**: v18 or later.
2.  **Supabase Account**: For the database (PostgreSQL).
3.  **Discord Developer Account**: To create the bot.
4.  **Roblox Studio**: To add the scripts to your game.
5.  **Vercel Account**: (Optional but recommended) For hosting.

---

## üèóÔ∏è 1. Database Setup (Supabase)

Create a new Supabase project and run the following SQL queries in the SQL Editor to set up the tables:

```sql
-- Servers Table: Stores linked Discord servers and API keys
create table public.servers (
  id text not null primary key,           -- Discord Guild ID
  linked_place_id text,                   -- Roblox Place ID
  universe_id text,                       -- Roblox Universe ID
  open_cloud_key text,                    -- Encrypted Open Cloud Key
  api_key text unique not null,           -- Generated API Key for Roblox
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Command Queue: Queues commands for Roblox servers to pick up
create table public.command_queue (
  id bigint generated by default as identity primary key,
  server_id text references public.servers(id),
  command text not null,                  -- e.g., 'KICK', 'BAN', 'FLY'
  args jsonb,                             -- Command arguments {username: '...', reason: '...'}
  status text default 'PENDING',          -- 'PENDING', 'PROCESSED', 'FAILED'
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Logs: Audit log for all actions
create table public.logs (
  id bigint generated by default as identity primary key,
  server_id text references public.servers(id),
  action text not null,
  target text,                            -- Username or 'ALL'
  moderator text,                         -- Discord Tag or ID
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Bot Stats: Global statistics
create table public.bot_stats (
  id text primary key,                    -- Use 'global'
  guild_count int,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Live Servers: Tracks active game servers
create table public.live_servers (
  id uuid default gen_random_uuid() primary key,
  job_id text not null,
  player_count int,
  players jsonb,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);
```

---

## ‚öôÔ∏è 2. Environment Variables

Create a `.env.local` file in the root directory and add the following keys:

```bash
# Discord Configuration
DISCORD_TOKEN=your_bot_token_here
DISCORD_CLIENT_ID=your_application_id_here
DISCORD_PUBLIC_KEY=your_public_key_here
DISCORD_BEARER_TOKEN=your_oauth2_bearer_token_here # Optional: For status updates via API

# Application URL (Production or Localhost)
NEXT_PUBLIC_BASE_URL=http://localhost:3000

# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

---

## ü§ñ 3. Discord Bot Setup

1.  Go to the [Discord Developer Portal](https://discord.com/developers/applications).
2.  Create a **New Application**.
3.  **Bot Tab**:
    - Click "Add Bot".
    - Copy the **Token** into `DISCORD_TOKEN`.
    - Enable **Privileged Gateway Intents**: `MESSAGE CONTENT INTENT`, `SERVER MEMBERS INTENT`, `PRESENCE INTENT`.
4.  **General Information**:
    - Copy **Application ID** into `DISCORD_CLIENT_ID`.
    - Copy **Public Key** into `DISCORD_PUBLIC_KEY`.
5.  **Interactions Endpoint URL**:
    - When deploying to Vercel, set this to: `https://your-project.vercel.app/api/interactions`.
    - Locally, you can use a tunneling service (like ngrok) or skip this step until deployed.

---

## üíª 4. Running Locally

### Development Server
Start the Next.js development server and the Discord bot simultaneously:
```bash
npm run dev
```

### Standalone Bot (for Production Stats)
If you have deployed the website to Vercel but want to keep the bot status ("Watching X Servers") active, you can run just the bot script on a VPS or your local machine:
```bash
npm run bot
```

---

## ‚òÅÔ∏è 5. Deployment (Vercel)

1.  Push your code to GitHub.
2.  Import the project into Vercel.
3.  Add all the **Environment Variables** from step 2 into the Vercel project settings.
4.  Deploy.
5.  **Crucial**: Go back to the Discord Developer Portal and set the **Interactions Endpoint URL** to `https://your-vercel-app.vercel.app/api/interactions`.

---

## üéÆ 6. Roblox Setup

Once your web server is running and your Discord server is linked via `/setup`:

1.  **Open Roblox Studio**.
2.  **Enable HTTP Services**: Go to `Game Settings > Security` and enable **Allow HTTP Requests** and **Enable Studio Access to API Services**.
3.  **Create ModuleScript**:
    - In `ReplicatedStorage`, create a `ModuleScript` named `RoLink`.
    - Paste the code generated by the `/setup` command (or ask the bot for it again).
4.  **Create Server Script**:
    - In `ServerScriptService`, create a `Script`.
    - Add the following initialization code:

```lua
local RoLink = require(game.ReplicatedStorage:WaitForChild('RoLink'))
RoLink:Initialize()
```

5.  **Test**: Run your game in Studio. If setup correctly, you should see polling logs in the Output window, and commands from Discord should execute immediately.

---

## ‚ö†Ô∏è Troubleshooting

-   **Bot Offline?**: The Vercel integration is serverless, so the bot won't show as "Online" unless you run `npm run bot` on a VPS or local machine. However, commands will still work perfectly via slash commands.
-   **Commands Not Working?**: Ensure the `Intents` are enabled in the Developer Portal.
-   **Database Errors**: Check your Supabase tables and RLS (Row Level Security) policies.
